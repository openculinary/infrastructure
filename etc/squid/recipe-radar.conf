# Auto-generate certificates for SSL traffic
http_port 192.168.100.1:3443 \
    ssl-bump intercept generate-host-certificates=on dynamic_cert_mem_cache_size=4MB \
    cert=/etc/squid/certificates/ca.crt key=/etc/squid/certificates/ca.key

# Always peek first, then bump connections
ssl_bump peek all
ssl_bump bump all

# Allow traffic from the cluster network
http_access allow localnet
cache deny to_localhost

# Cache everything aggressively
refresh_pattern . 1440 100% 525600 override-expire override-lastmod ignore-reload ignore-no-store ignore-private 
offline_mode on

# Send all traffic via parent privoxy proxy
cache_peer 127.0.0.1 parent 8118 0 no-query no-digest
cache_peer_access 127.0.0.1 allow all
prefer_direct off
never_direct allow all
