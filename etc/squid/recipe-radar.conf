# Auto-generate certificates for SSL traffic
http_port 192.168.100.1:3443 \
    ssl-bump generate-host-certificates=on dynamic_cert_mem_cache_size=4MB \
    cert=/etc/squid/certificates/ca.crt key=/etc/squid/certificates/ca.key

ssl_bump bump all

# Allow traffic from the cluster network
http_access allow localnet
cache deny to_localhost

# Cache everything aggressively
refresh_pattern . 1440 100% 525600 override-expire override-lastmod ignore-reload ignore-no-store ignore-private 
offline_mode on

# Configure upstream privoxy proxy
cache_peer 127.0.0.1 parent 8118 0 no-query no-digest

# Force all traffic including SSL to go indirect via parent proxy
acl ssl method connect
always_direct deny ssl
never_direct allow all
